<div class="manage-bookings-container">
  <mat-toolbar color="primary">
    <span>Manage All Booking Requests</span>
  </mat-toolbar>

  <div *ngIf="isLoading" class="loading-indicator">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <div *ngIf="!isLoading && allBookingRequests.length === 0" class="no-requests-message">
    <p>No booking requests found.</p>
  </div>

  <div *ngIf="!isLoading && allBookingRequests.length > 0" class="requests-list-container">
    <mat-card *ngFor="let request of allBookingRequests" class="request-card" [ngClass]="getStatusClass(request.status)">
      <mat-card-header>
        <img mat-card-avatar [src]="request.student?.profilePictureUrl" alt="Student Avatar" class="student-avatar">
        <mat-card-title>{{ request.student?.fullName || 'Unknown Student' }}</mat-card-title>
        <mat-card-subtitle>
          Requested Slot: {{ formatRequestTime(request) }} <br>
          Request Date: {{ getRequestDate(request) }}
        </mat-card-subtitle>
        <span class="request-status" [ngClass]="getStatusClass(request.status)">{{ request.status | titlecase }}</span>
      </mat-card-header>
      <mat-card-content>
        <p *ngIf="request.studentNotes" class="notes student-notes">
          <strong>Student Notes:</strong> {{ request.studentNotes }}
        </p>
        <p *ngIf="request.teacherNotes && request.status !== 'pending'" class="notes teacher-notes">
          <strong>Your Notes:</strong> {{ request.teacherNotes }}
        </p>

        <mat-form-field appearance="outline" class="full-width-field teacher-notes-field" *ngIf="request.status === 'pending'">
          <mat-label>Notes for Student (Optional)</mat-label>
          <textarea matInput [(ngModel)]="teacherNotesMap[request.id]" rows="2"></textarea>
        </mat-form-field>
      </mat-card-content>
      <mat-card-actions align="end" *ngIf="request.status === 'pending'">
        <button mat-stroked-button color="warn" (click)="rejectRequest(request)">
          <mat-icon>close</mat-icon> Reject
        </button>
        <button mat-flat-button color="primary" (click)="acceptRequest(request)" class="accept-button">
          <mat-icon>check</mat-icon> Accept
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
