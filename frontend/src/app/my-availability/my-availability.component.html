<div class="availability-container">
  <mat-toolbar color="primary">
    <span>My Availability - {{ currentMonthDisplay }}</span>
  </mat-toolbar>

  <div class="calendar-header">
    <h2>Manage Your Weekly Availability</h2>
    <p>Click on a day to add or modify your available time slots.</p>
  </div>

  <div *ngIf="isLoading" class="loading-indicator">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <div *ngIf="!isLoading && currentUser" class="calendar-table-container">
    <table class="calendar-table">
      <thead>
        <tr>
          <th *ngFor="let header of weekDayHeaders">{{ header }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let week of calendarWeeks">
          <td *ngFor="let day of week"
              [class.today]="day.isToday"
              [class.past-day]="day.isPast"
              [class.other-month]="!day.isCurrentMonth"
              [class.current-date-outline]="day.isToday"
              [class.status-default]="day.statusColor === 'default' && !day.isPast && day.isCurrentMonth"
              [class.status-green]="day.statusColor === 'green' && !day.isPast && day.isCurrentMonth"
              [class.status-yellow]="day.statusColor === 'yellow' && !day.isPast && day.isCurrentMonth"
              [class.status-red]="day.statusColor === 'red' && !day.isPast && day.isCurrentMonth"
              (click)="openAvailabilityPopup(day)"
              [title]="day.isPast ? 'Cannot set availability for past dates' : (day.isCurrentMonth ? 'Click to manage slots' : 'Day not in current view focus')">
            <div class="day-cell-content">
              <span class="day-number">{{ day.dayOfMonth }}</span>
              <div class="slot-info-container" *ngIf="day.isCurrentMonth && !day.isPast">
                <div *ngIf="day.totalSlots > 0" class="slot-indicators">
                    <span *ngFor="let i of [].constructor(day.totalSlots); let idx = index"
                          class="slot-dot"
                          [class.booked]="idx < day.bookedSlots">
                    </span>
                </div>
                <span class="status-text">{{ day.statusText }}</span>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!currentUser && !isLoading" class="no-user-message">
    <p>Please log in as a teacher to manage availability.</p>
  </div>
</div>
