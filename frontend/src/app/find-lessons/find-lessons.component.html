<div class="page-content-container">
  <div class="page-header">
    <h1>Find Available Lessons</h1>
    <p>Browse availability for {{ currentMonthDisplay }} from teachers you follow.</p>
  </div>

  <div *ngIf="isLoading" class="loading-spinner-container">
    <mat-progress-spinner diameter="50"></mat-progress-spinner>
  </div>

  <div *ngIf="!isLoading && currentUser && calendarWeeks.length > 0" class="calendar-table-container">
    <p class="calendar-info">Click on a green day to see available slots.</p>
    <table class="calendar-table">
      <thead>
        <tr>
          <th *ngFor="let header of weekDayHeaders">{{ header }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let week of calendarWeeks">
          <td *ngFor="let day of week"
              [class.today]="day.isToday"
              [class.past-day]="day.isPast"
              [class.status-default]="!day.isCurrentMonth"
              [class.current-date-outline]="day.isToday"
              [class.status-default]="day.statusColor === 'default' && !day.isPast && day.isCurrentMonth"
              [class.status-green]="day.statusColor === 'green' && !day.isPast && day.isCurrentMonth"
              (click)="openBookingPopup(day)"
              [title]="day.isPast ? 'Cannot book for past dates' : (day.availableSlotsOnDay.length > 0 ? 'Click to view available slots' : 'No slots available')">
            <div class="day-cell-content">
              <span class="day-number">{{ day.dayOfMonth }}</span>
              <div class="slot-info-container" *ngIf="day.isCurrentMonth && !day.isPast && day.availableSlotsOnDay.length > 0">
                <mat-icon class="available-icon">event_available</mat-icon>
                <span class="status-text">{{ day.statusText }}</span>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!isLoading && currentUser && (!currentUser.subscribedTeacherIds || currentUser.subscribedTeacherIds.length === 0)" class="no-data-message">
    <p>You are not subscribed to any teachers. Please search for teachers and subscribe to view their availability.</p>
    <button mat-stroked-button color="primary" routerLink="/search">Search Teachers</button>
  </div>

  <div *ngIf="!isLoading && !currentUser" class="no-data-message">
    <p>Please log in to book lessons.</p>
  </div>
</div>
