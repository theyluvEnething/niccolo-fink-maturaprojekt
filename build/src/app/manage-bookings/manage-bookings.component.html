<div class="page-content-container">
  <div class="page-header">
    <h1>Manage Booking Requests</h1>
    <p>Review and respond to lesson requests from students.</p>
  </div>

  <div *ngIf="isLoading" class="loading-spinner-container">
    <mat-progress-spinner diameter="50"></mat-progress-spinner>
  </div>

  <div *ngIf="!isLoading && allBookingRequests.length === 0" class="no-data-message">
    <p>No booking requests found.</p>
  </div>

  <div *ngIf="!isLoading && allBookingRequests.length > 0" class="requests-list-container grid-container">
    <mat-card *ngFor="let request of allBookingRequests" class="request-card item-card" [ngClass]="getStatusClass(request.status)">
      <mat-card-header>
        <img mat-card-avatar [src]="request.student?.profilePictureUrl || defaultProfilePic" alt="Student Avatar" class="item-avatar">
        <mat-card-title class="item-title">{{ request.student?.fullName || 'Unknown Student' }}</mat-card-title>
        <mat-card-subtitle class="request-details">
          Slot: {{ formatRequestTime(request) }} <br>
          Requested: {{ getRequestDate(request) }}
        </mat-card-subtitle>
        <span class="request-status-badge" [ngClass]="getStatusClass(request.status)">{{ request.status | titlecase }}</span>
      </mat-card-header>
      <mat-card-content class="item-card-content">
        <p *ngIf="request.studentNotes" class="notes student-notes">
          <strong>Student Notes:</strong> {{ request.studentNotes }}
        </p>
        <p *ngIf="request.teacherNotes && request.status !== 'pending'" class="notes teacher-notes">
          <strong>Your Notes:</strong> {{ request.teacherNotes }}
        </p>

        <mat-form-field appearance="outline" class="full-width-field teacher-notes-field" *ngIf="request.status === 'pending'">
          <mat-label>Notes for Student (Optional)</mat-label>
          <textarea matInput [(ngModel)]="teacherNotesMap[request.id]" rows="2"></textarea>
        </mat-form-field>
      </mat-card-content>
      <mat-card-actions align="end" *ngIf="request.status === 'pending'">
        <button mat-stroked-button color="warn" (click)="rejectRequest(request)">
          <mat-icon>close</mat-icon> Reject
        </button>
        <button mat-flat-button color="primary" (click)="acceptRequest(request)" class="accept-button">
          <mat-icon>check</mat-icon> Accept
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
